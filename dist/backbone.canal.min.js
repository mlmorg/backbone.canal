/*!
 * backbone.canal v0.1.0
 * Copyright 2013, Matt Morgan (@mlmorg)
 * MIT license
 */
(function(){"use strict";var t=this,r=t._,e=t.Backbone,n=e.Router.prototype._routeToRegExp,o=e.Router.prototype._extractParameters,a=/[\:\*]\w+/g,i=/\?.*$/,s=/\+/g,u=e.Canal={configure:function(t){return r.extend(this.options,t)},options:{deparam:function(t){var e=t.replace(s," ").split("&"),n={};return r.each(e,function(t){var r=t.split("=");n[r[0]]=decodeURIComponent(r[1])}),n}}};r.extend(e.Router.prototype,{route:function(t,n,o){return r.isRegExp(t)||(t=this._routeToRegExp(t)),o||(o=this[n]),e.history.route(t,r.bind(function(r,a){var i=this._extractParameters(t,r),s=this._extractQueryParameters(a),u=[i,s];o&&o.apply(this,u),this.trigger.apply(this,["route:"+n].concat(u)),this.trigger("route",n,u),e.history.trigger("route",this,n,u)},this)),this},_routeToRegExp:function(t){var e=r.map(t.match(a),function(t){return t.substring(1)}),o=n(t);return o.names=e,o},_extractParameters:function(t,e){var n={},a=o(t,e);return a&&r.each(a,function(r,e){n[t.names[e]]=r}),n},_extractQueryParameters:function(t){return t?u.options.deparam(t.substring(1)):{}}}),r.extend(e.History.prototype,{loadUrl:function(t){var e=this.fragment=this.getFragment(t),n=e.match(i)||"";n&&(n=n[0],e=e.replace(n,""));var o=r.any(this.handlers,function(t){return t.route.test(e)?(t.callback(e,n),!0):void 0});return o}})}).call(this);