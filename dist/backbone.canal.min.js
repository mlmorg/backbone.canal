/*!
 * backbone.canal v0.1.0
 * Copyright 2013, Matt Morgan (@mlmorg)
 * MIT license
 */
(function(){"use strict";var t=this,r=t._,e=t.Backbone,n=e.Router.prototype._routeToRegExp,o=e.Router.prototype._extractParameters,i=/[\:\*]\w+/g,a=/\?.*$/,s=/\+/g,u=e.Canal={configure:function(t){return r.extend(this.options,t)},options:{deparam:function(t){var e=t.replace(s," ").split("&"),n={};return r.each(e,function(t){var r=t.split("=");n[r[0]]=decodeURIComponent(r[1])}),n}}};r.extend(e.Router.prototype,{route:function(t,n,o){return r.isRegExp(t)||(t=this._routeToRegExp(t)),o||(o=this[n]),e.history.route(t,r.bind(function(r,i){var a=this._extractParameters(t,r,i),s=[a];o&&o.apply(this,s),this.trigger.apply(this,["route:"+n].concat(s)),this.trigger("route",n,s),e.history.trigger("route",this,n,s)},this)),this},_routeToRegExp:function(t){var e=r.map(t.match(i),function(t){return t.substring(1)}),o=n(t);return o.names=e,o},_extractParameters:function(t,e,n){var i={};n&&r.extend(i,u.options.deparam(n.substring(1)));var a=o(t,e);return a&&r.each(a,function(r,e){i[t.names[e]]=r}),i}}),r.extend(e.History.prototype,{loadUrl:function(t){var e=this.fragment=this.getFragment(t),n=e.match(a)||"";n&&(n=n[0],e=e.replace(n,""));var o=r.any(this.handlers,function(t){return t.route.test(e)?(t.callback(e,n),!0):void 0});return o}})}).call(this);